<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>BMS â€“ Business Management System</title>

    <!-- External Libraries -->
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2/dist/umd/supabase.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.31/jspdf.plugin.autotable.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/jsbarcode@3.11.6/dist/JsBarcode.all.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            darkMode: 'class',
            theme: {
                extend: {
                    colors: {
                        // Custom colors if needed
                    }
                }
            }
        }
    </script>
    <script>
            // Immediate theme initialization to avoid flash
            (function () {
                const theme = localStorage.getItem('bms-theme') || 'light';
                if (theme === 'dark') document.documentElement.classList.add('dark');
            })();
    </script>
    <script src="https://unpkg.com/lucide@latest"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/3.9.1/chart.min.js"></script>

    <!-- App Styles -->
    <link rel="stylesheet" href="css/index.css">

    <!-- PWA & Mobile -->
    <link rel="manifest" href="manifest.json">
    <link rel="icon" type="image/jpeg" href="logo.jpg">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <link rel="apple-touch-icon" href="logo.jpg">
</head>

<body class="bg-gray-50 text-gray-900">
    <!-- Initial App Loader -->
    <div id="initial-loader"
        class="fixed inset-0 z-[10000] flex flex-col items-center justify-center bg-white dark:bg-[#0b141a] transition-opacity duration-500">
        <div class="loader-content !shadow-none !border-none !bg-transparent">
            <div class="premium-spinner"></div>
            <p class="loader-text mt-4">Initializing BMS...</p>
        </div>
    </div>

    <!-- â”€â”€ Login Screen â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ -->
    <div id="loginScreen" class="fixed inset-0 gradient-bg flex items-center justify-center z-50 p-4">
        <canvas id="bg-canvas"></canvas>
        <div class="login-glass rounded-[2rem] p-8 md:p-10 w-full max-w-[420px] modal-enter relative">
            <div class="text-center mb-6">
                <div
                    class="w-16 h-16 rounded-2xl flex items-center justify-center mx-auto shadow-lg shadow-indigo-500/30 overflow-hidden bg-white">
                    <img src="logo.jpg" alt="BMS Logo" class="w-full h-full object-cover">
                </div>
            </div>

            <div class="space-y-5">
                <div class="text-center mb-4">
                    <p class="login-subtitle text-gray-500 text-sm font-medium">Welcome back, please sign in</p>
                </div>
                <!-- Role Toggle -->
                <div
                    class="login-role-toggle relative bg-gray-100/80 p-1.5 rounded-xl flex items-center mb-6 border border-gray-200/50">
                    <div id="roleSlider"
                        class="absolute left-1.5 top-1.5 bottom-1.5 w-[calc(50%-6px)] bg-white rounded-lg role-slider-active transition-all duration-300 ease-[cubic-bezier(0.4,0,0.2,1)]">
                    </div>

                    <button type="button" onclick="setLoginRole('owner')"
                        class="flex-1 relative z-10 py-2.5 text-[0.9rem] font-semibold text-center rounded-lg transition-colors duration-200 text-indigo-600"
                        id="btn-owner">
                        Business Admin
                    </button>

                    <button type="button" onclick="setLoginRole('branch')"
                        class="flex-1 relative z-10 py-2.5 text-[0.9rem] font-medium text-center rounded-lg transition-colors duration-200 text-gray-500"
                        id="btn-branch">
                        Branch Manager
                    </button>

                    <!-- Hidden input to maintain compatibility with existing JS -->
                    <input type="hidden" id="roleSelect" value="owner">
                </div>

                <!-- Owner fields (shown by default) -->
                <div id="ownerFields">
                    <!-- Login Form -->
                    <div id="loginForm" class="space-y-3">
                        <div>
                            <label for="ownerEmail"
                                class="login-label block text-sm font-medium text-gray-700 mb-1.5">Email
                                Address</label>
                            <div class="relative">
                                <div class="absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none">
                                    <i data-lucide="mail" class="w-5 h-5 text-gray-400"></i>
                                </div>
                                <input type="email" id="ownerEmail" placeholder="owner@business.com"
                                    class="form-input auth-input pl-10" onkeydown="if(event.key==='Enter') login()">
                            </div>
                        </div>
                        <div>
                            <label for="ownerPassword"
                                class="login-label block text-sm font-medium text-gray-700 mb-1.5">Password</label>
                            <div class="relative">
                                <div class="absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none">
                                    <i data-lucide="lock" class="w-5 h-5 text-gray-400"></i>
                                </div>
                                <input type="password" id="ownerPassword" placeholder="Enter your password"
                                    class="form-input auth-input pl-10 pr-10"
                                    onkeydown="if(event.key==='Enter') login()">
                                <button type="button" onclick="togglePasswordVisibility('ownerPassword', this)"
                                    class="absolute right-3 top-1/2 -translate-y-1/2 focus:outline-none">
                                    <i data-lucide="eye" class="w-4 h-4 text-gray-400"></i>
                                </button>
                            </div>
                            <div class="text-right mt-1">
                                <button onclick="toggleResetPassword()"
                                    class="text-xs text-indigo-600 hover:text-indigo-800">
                                    Forgot Password?
                                </button>
                            </div>
                        </div>
                    </div>

                    <!-- Registration Form (hidden by default) -->
                    <div id="registerForm" class="hidden space-y-3">
                        <div>
                            <label for="regBusinessName"
                                class="login-label block text-sm font-medium text-gray-700 mb-1.5">Business
                                Name</label>
                            <div class="relative">
                                <div class="absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none">
                                    <i data-lucide="building" class="w-5 h-5 text-gray-400"></i>
                                </div>
                                <input type="text" id="regBusinessName" placeholder="My Business"
                                    class="form-input auth-input pl-10">
                            </div>
                        </div>
                        <div>
                            <label for="regPhone"
                                class="login-label block text-sm font-medium text-gray-700 mb-1.5">Mobile
                                Number</label>
                            <div class="flex gap-2 relative">
                                <div class="absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none z-10">
                                    <i data-lucide="phone" class="w-5 h-5 text-gray-400"></i>
                                </div>
                                <select id="regCountryCode" class="form-input auth-input w-32 pl-10">
                                    <option value="+254">ðŸ‡°ðŸ‡ª +254</option>
                                    <option value="+255">ðŸ‡¹ðŸ‡¿ +255</option>
                                    <option value="+256">ðŸ‡ºðŸ‡¬ +256</option>
                                    <option value="+250">ðŸ‡·ðŸ‡¼ +250</option>
                                    <option value="+1">ðŸ‡ºðŸ‡¸ +1</option>
                                    <option value="+44">ðŸ‡¬ðŸ‡§ +44</option>
                                    <option value="">Other</option>
                                </select>
                                <input type="tel" id="regPhone" placeholder="712 345 678"
                                    class="form-input auth-input flex-1">
                            </div>
                        </div>
                        <div>
                            <label for="regEmail"
                                class="login-label block text-sm font-medium text-gray-700 mb-1.5">Email
                                Address</label>
                            <div class="relative">
                                <div class="absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none">
                                    <i data-lucide="mail" class="w-5 h-5 text-gray-400"></i>
                                </div>
                                <input type="email" id="regEmail" placeholder="owner@business.com"
                                    class="form-input auth-input pl-10">
                            </div>
                        </div>
                        <div>
                            <label for="regPassword"
                                class="login-label block text-sm font-medium text-gray-700 mb-1.5">Password</label>
                            <div class="relative">
                                <div class="absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none">
                                    <i data-lucide="lock" class="w-5 h-5 text-gray-400"></i>
                                </div>
                                <input type="password" id="regPassword" placeholder="Create a password"
                                    class="form-input auth-input pl-10 pr-10">
                                <button type="button" onclick="togglePasswordVisibility('regPassword', this)"
                                    class="absolute right-3 top-1/2 -translate-y-1/2 focus:outline-none">
                                    <i data-lucide="eye" class="w-4 h-4 text-gray-400"></i>
                                </button>
                            </div>
                        </div>
                        <div class="text-center pt-2">
                            <button onclick="toggleRegistration()"
                                class="text-sm text-indigo-600 hover:text-indigo-800 font-medium">
                                Back to Login
                            </button>
                        </div>
                        <button onclick="register()"
                            class="w-full btn-primary justify-center py-3 text-base rounded-xl mt-4">
                            Create Account
                        </button>
                    </div>
                    <!-- Password Reset Form (hidden by default) -->
                    <div id="resetPasswordForm" class="hidden space-y-3">
                        <div class="text-center mb-4">
                            <h3 class="login-label text-lg font-bold text-gray-900">Reset Password</h3>
                            <p class="login-subtitle text-sm text-gray-500">Enter your email to receive a reset link.
                            </p>
                        </div>
                        <div>
                            <label for="resetEmail"
                                class="login-label block text-sm font-medium text-gray-700 mb-1.5">Email
                                Address</label>
                            <div class="relative">
                                <div class="absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none">
                                    <i data-lucide="mail" class="w-5 h-5 text-gray-400"></i>
                                </div>
                                <input type="email" id="resetEmail" placeholder="owner@business.com"
                                    class="form-input auth-input pl-10">
                            </div>
                        </div>
                        <button onclick="handlePasswordReset()"
                            class="w-full btn-primary justify-center py-2.5 text-base rounded-xl mt-2">
                            Send Reset Link
                        </button>
                        <div class="text-center pt-2">
                            <button onclick="toggleResetPassword()"
                                class="text-sm text-gray-500 hover:text-gray-700 font-medium">
                                Back to Login
                            </button>
                        </div>
                    </div>
                </div>

            </div>

            <!-- Branch PIN Reset Request Modal (hidden by default) -->
            <div id="branchPinReset" class="hidden space-y-3">
                <div class="text-center mb-4">
                    <h3 class="login-label text-lg font-bold text-gray-900">Request PIN Reset</h3>
                    <p class="login-subtitle text-sm text-gray-500">Ask the admin to reset your PIN.</p>
                </div>
                <div>
                    <label for="reqOwnerEmail" class="login-label block text-sm font-medium text-gray-700 mb-1.5">Admin
                        Email</label>
                    <div class="relative">
                        <div class="absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none">
                            <i data-lucide="mail" class="w-5 h-5 text-gray-400"></i>
                        </div>
                        <input type="email" id="reqOwnerEmail" placeholder="owner@business.com"
                            class="form-input auth-input pl-10">
                    </div>
                </div>
                <div>
                    <label for="reqBranchName" class="login-label block text-sm font-medium text-gray-700 mb-1.5">Branch
                        Name</label>
                    <div class="relative">
                        <div class="absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none">
                            <i data-lucide="building-2" class="w-5 h-5 text-gray-400"></i>
                        </div>
                        <input type="text" id="reqBranchName" placeholder="Main Branch"
                            class="form-input auth-input pl-10">
                    </div>
                </div>
                <button onclick="requestPinReset()"
                    class="w-full btn-primary justify-center py-2.5 text-base rounded-xl mt-2">
                    Send Request
                </button>
                <div class="text-center pt-2">
                    <button onclick="toggleBranchPinReset()"
                        class="text-sm text-gray-500 hover:text-gray-700 font-medium">
                        Back to Login
                    </button>
                </div>
            </div>

            <!-- Branch fields (hidden by default) -->
            <div id="branchSelector" class="hidden space-y-3">
                <div>
                    <label for="branchEmailInput"
                        class="login-label block text-sm font-medium text-gray-700 mb-1.5">Manager
                        Email</label>
                    <div class="relative">
                        <div class="absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none">
                            <i data-lucide="mail" class="w-5 h-5 text-gray-400"></i>
                        </div>
                        <input type="email" id="branchEmailInput" placeholder="manager@branch.com" autocomplete="email"
                            class="form-input auth-input pl-10">
                    </div>
                </div>
                <div>
                    <label for="branchPasswordInput"
                        class="login-label block text-sm font-medium text-gray-700 mb-1.5">Password</label>
                    <div class="relative">
                        <div class="absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none">
                            <i data-lucide="lock" class="w-5 h-5 text-gray-400"></i>
                        </div>
                        <input type="password" id="branchPasswordInput" placeholder="Enter password"
                            class="form-input auth-input pl-10 pr-10" onkeydown="if(event.key==='Enter') login()">
                        <button type="button" onclick="togglePasswordVisibility('branchPasswordInput', this)"
                            class="absolute right-3 top-1/2 -translate-y-1/2 focus:outline-none z-10">
                            <i data-lucide="eye" class="w-4 h-4 text-gray-400"></i>
                        </button>
                    </div>
                    <div class="text-right mt-1">
                        <button onclick="toggleBranchPinReset()" class="text-xs text-indigo-600 hover:text-indigo-800">
                            Forgot Password?
                        </button>
                    </div>
                </div>
            </div>

            <button id="mainLoginBtn" onclick="login()"
                class="w-full btn-primary justify-center py-3 text-base rounded-xl mt-4">
                <i data-lucide="log-in" class="w-5 h-5"></i>
                Access Dashboard
            </button>
            <div id="regToggle" class="text-center pt-4">
                <button onclick="toggleRegistration()"
                    class="text-sm text-indigo-600 hover:text-indigo-800 font-medium transition-colors">
                    Create new account
                </button>
            </div>
        </div>
    </div>
    </div>

    <!-- â”€â”€ Main Application â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ -->
    <div id="app" class="hidden">
        <!-- Header -->
        <header class="bg-white border-b border-gray-100 sticky top-0 z-40 shadow-sm">
            <div class="flex items-center justify-between px-4 md:px-6 py-3.5">
                <div class="flex items-center gap-3">
                    <!-- Hamburger Menu (Mobile Only) -->
                    <button onclick="toggleSidebar()"
                        class="md:hidden p-2 -ml-2 text-gray-500 hover:bg-gray-100 rounded-lg">
                        <i data-lucide="menu" class="w-6 h-6"></i>
                    </button>


                    <div>
                        <p id="userRole"
                            class="text-[10px] md:text-xs font-semibold text-indigo-700 bg-indigo-50 px-2.5 py-1 rounded-md border border-indigo-100 uppercase tracking-wider shadow-sm leading-tight">
                            Admin</p>
                    </div>
                </div>

                <div class="flex items-center gap-3">


                    <!-- Grouped Controls -->
                    <div
                        class="flex items-center bg-white border border-gray-200 rounded-xl p-0.5 shadow-sm theme-control">
                        <button onclick="toggleTheme()" id="themeToggle" title="Toggle Theme"
                            class="p-2 text-gray-500 hover:bg-gray-50 rounded-lg transition-colors group">
                            <i data-lucide="moon" class="w-5 h-5 dark:hidden"></i>
                            <i data-lucide="sun" class="w-5 h-5 hidden dark:block"></i>
                        </button>

                        <div class="w-px h-4 bg-gray-100 mx-1"></div>

                        <button onclick="showNotifications()"
                            class="relative p-2 text-gray-500 hover:bg-gray-50 rounded-lg transition-colors group">
                            <i data-lucide="bell" class="w-5 h-5 group-hover:text-indigo-600"></i>
                            <span id="notifBadge"
                                class="absolute top-2 right-2 w-2 h-2 bg-red-500 rounded-full border-2 border-white hidden"></span>
                        </button>

                        <div class="w-px h-4 bg-gray-100 mx-1"></div>

                        <button onclick="logout()" title="Logout"
                            class="p-2 text-gray-500 hover:bg-red-50 hover:text-red-600 rounded-lg transition-colors group">
                            <i data-lucide="log-out" class="w-5 h-5" stroke-width="2.5"></i>
                        </button>
                    </div>
                </div>
            </div>
        </header>

        <div class="flex h-[calc(100dvh-57px)] relative bg-gray-50">
            <!-- Sidebar Overlay (Mobile) -->
            <div id="sidebarOverlay" onclick="toggleSidebar()"
                class="fixed inset-0 bg-black/50 z-20 hidden md:hidden backdrop-blur-sm transition-opacity"></div>

            <!-- Sidebar -->
            <aside id="mainSidebar" class="w-64 bg-white flex flex-col flex-shrink-0 
                          fixed top-[57px] left-0 md:top-auto md:left-auto md:relative z-30 transition-transform duration-300 transform 
                          -translate-x-[calc(100%+1rem)] md:translate-x-0 shadow-[4px_0_24px_rgba(0,0,0,0.04)]
                          m-4 rounded-3xl h-[calc(100dvh-57px-32px)]">
                <nav class="flex-1 p-3 space-y-0.5 overflow-y-auto" id="sidebarNav">

                    <!-- Owner Navigation -->
                    <div id="ownerNav" class="hidden space-y-0.5">
                        <button onclick="switchView('overview',this)"
                            class="sidebar-item active w-full flex items-center gap-3 px-4 py-2.5 rounded-xl text-left text-sm font-medium text-indigo-600 bg-indigo-50">
                            <i data-lucide="layout-dashboard" class="w-4 h-4 flex-shrink-0"></i> Overview
                        </button>
                        <button onclick="switchView('branches',this)"
                            class="sidebar-item w-full flex items-center gap-3 px-4 py-2.5 rounded-xl text-left text-sm font-medium text-gray-700">
                            <i data-lucide="git-branch" class="w-4 h-4 flex-shrink-0"></i> Branches
                        </button>
                        <button onclick="switchView('tasks',this)"
                            class="sidebar-item w-full flex items-center gap-3 px-4 py-2.5 rounded-xl text-left text-sm font-medium text-gray-700">
                            <i data-lucide="check-square" class="w-4 h-4 flex-shrink-0"></i>
                            <span class="flex-1">Tasks & Objectives</span>
                            <span id="ownerTasksBadge"
                                class="hidden bg-indigo-600 text-white text-[10px] font-black w-5 h-5 flex items-center justify-center rounded-full">0</span>
                        </button>
                        <button onclick="switchView('analytics',this)"
                            class="sidebar-item w-full flex items-center gap-3 px-4 py-2.5 rounded-xl text-left text-sm font-medium text-gray-700">
                            <i data-lucide="bar-chart-3" class="w-4 h-4 flex-shrink-0"></i> Analytics
                        </button>
                        <button onclick="switchView('security',this)"
                            class="sidebar-item w-full flex items-center gap-3 px-4 py-2.5 rounded-xl text-left text-sm font-medium text-gray-700">
                            <i data-lucide="shield" class="w-4 h-4 flex-shrink-0"></i> Security
                        </button>
                        <button onclick="switchView('requests',this)"
                            class="sidebar-item w-full flex items-center gap-3 px-4 py-2.5 rounded-xl text-left text-sm font-medium text-gray-700">
                            <i data-lucide="shield-check" class="w-4 h-4 flex-shrink-0"></i>
                            <span class="flex-1">Approval Queue</span>
                            <span id="approvalBadge"
                                class="hidden bg-indigo-600 text-white text-[10px] font-black w-5 h-5 flex items-center justify-center rounded-full">0</span>
                        </button>
                        <button onclick="switchView('chat',this)"
                            class="sidebar-item w-full flex items-center gap-3 px-4 py-2.5 rounded-xl text-left text-sm font-medium text-gray-700">
                            <i data-lucide="message-square" class="w-4 h-4 flex-shrink-0"></i>
                            <span class="flex-1">Messages</span>
                            <span
                                class="chat-unread-badge hidden bg-red-500 text-white text-[10px] font-black w-5 h-5 flex items-center justify-center rounded-full">0</span>
                        </button>

                        <!-- Module Monitoring -->
                        <div class="pt-3 pb-1 px-4">
                            <p class="text-[10px] font-bold text-gray-400 uppercase tracking-widest">Monitor</p>
                        </div>
                        <button onclick="switchView('staff',this)"
                            class="sidebar-item w-full flex items-center gap-3 px-4 py-2.5 rounded-xl text-left text-sm font-medium text-gray-700">
                            <i data-lucide="user-check" class="w-4 h-4 flex-shrink-0"></i> Staff & HR
                        </button>
                        <button onclick="switchView('suppliers',this)"
                            class="sidebar-item w-full flex items-center gap-3 px-4 py-2.5 rounded-xl text-left text-sm font-medium text-gray-700">
                            <i data-lucide="truck" class="w-4 h-4 flex-shrink-0"></i> Suppliers & POs
                        </button>
                        <button onclick="switchView('quotations',this)"
                            class="sidebar-item w-full flex items-center gap-3 px-4 py-2.5 rounded-xl text-left text-sm font-medium text-gray-700">
                            <i data-lucide="file-signature" class="w-4 h-4 flex-shrink-0"></i> Quotations
                        </button>
                    </div>

                    <!-- Branch Navigation -->
                    <div id="branchNav" class="hidden space-y-0.5">
                        <button onclick="switchView('dashboard',this)"
                            class="sidebar-item active w-full flex items-center gap-3 px-4 py-2.5 rounded-xl text-left text-sm font-medium text-indigo-600 bg-indigo-50">
                            <i data-lucide="home" class="w-4 h-4 flex-shrink-0"></i> Dashboard
                        </button>
                        <button onclick="switchView('sales',this)"
                            class="sidebar-item w-full flex items-center gap-3 px-4 py-2.5 rounded-xl text-left text-sm font-medium text-gray-700">
                            <i data-lucide="shopping-cart" class="w-4 h-4 flex-shrink-0"></i> Sales
                        </button>
                        <button onclick="switchView('expenses',this)"
                            class="sidebar-item w-full flex items-center gap-3 px-4 py-2.5 rounded-xl text-left text-sm font-medium text-gray-700">
                            <i data-lucide="credit-card" class="w-4 h-4 flex-shrink-0"></i> Expenses
                        </button>
                        <button onclick="switchView('inventory',this)"
                            class="sidebar-item w-full flex items-center gap-3 px-4 py-2.5 rounded-xl text-left text-sm font-medium text-gray-700">
                            <i data-lucide="package" class="w-4 h-4 flex-shrink-0"></i> Inventory
                        </button>
                        <button onclick="switchView('customers',this)"
                            class="sidebar-item w-full flex items-center gap-3 px-4 py-2.5 rounded-xl text-left text-sm font-medium text-gray-700">
                            <i data-lucide="users" class="w-4 h-4 flex-shrink-0"></i> Customers
                        </button>
                        <button onclick="switchView('staff',this)"
                            class="sidebar-item w-full flex items-center gap-3 px-4 py-2.5 rounded-xl text-left text-sm font-medium text-gray-700">
                            <i data-lucide="user-check" class="w-4 h-4 flex-shrink-0"></i> Staff & HR
                        </button>
                        <button onclick="switchView('suppliers',this)"
                            class="sidebar-item w-full flex items-center gap-3 px-4 py-2.5 rounded-xl text-left text-sm font-medium text-gray-700">
                            <i data-lucide="truck" class="w-4 h-4 flex-shrink-0"></i> Suppliers & POs
                        </button>
                        <button onclick="switchView('quotations',this)"
                            class="sidebar-item w-full flex items-center gap-3 px-4 py-2.5 rounded-xl text-left text-sm font-medium text-gray-700">
                            <i data-lucide="file-signature" class="w-4 h-4 flex-shrink-0"></i> Quotations
                        </button>
                        <button onclick="switchView('invoices',this)"
                            class="sidebar-item w-full flex items-center gap-3 px-4 py-2.5 rounded-xl text-left text-sm font-medium text-gray-700">
                            <i data-lucide="file-text" class="w-4 h-4 flex-shrink-0"></i> Invoices
                        </button>
                        <button onclick="switchView('tasks',this)"
                            class="sidebar-item w-full flex items-center gap-3 px-4 py-2.5 rounded-xl text-left text-sm font-medium text-gray-700">
                            <i data-lucide="list-todo" class="w-4 h-4 flex-shrink-0"></i>
                            <span class="flex-1">My Tasks</span>
                            <span id="branchTasksBadge"
                                class="hidden bg-indigo-600 text-white text-[10px] font-black w-5 h-5 flex items-center justify-center rounded-full">0</span>
                        </button>
                        <button onclick="switchView('reports',this)"
                            class="sidebar-item w-full flex items-center gap-3 px-4 py-2.5 rounded-xl text-left text-sm font-medium text-gray-700">
                            <i data-lucide="file-text" class="w-4 h-4 flex-shrink-0"></i> Reports
                        </button>
                        <button onclick="switchView('requests',this)"
                            class="sidebar-item w-full flex items-center gap-3 px-4 py-2.5 rounded-xl text-left text-sm font-medium text-gray-700">
                            <i data-lucide="send" class="w-4 h-4 flex-shrink-0"></i> My Requests
                        </button>
                        <button onclick="switchView('chat',this)"
                            class="sidebar-item w-full flex items-center gap-3 px-4 py-2.5 rounded-xl text-left text-sm font-medium text-gray-700">
                            <i data-lucide="message-square" class="w-4 h-4 flex-shrink-0"></i>
                            <span class="flex-1">Messages</span>
                            <span
                                class="chat-unread-badge hidden bg-red-500 text-white text-[10px] font-black w-5 h-5 flex items-center justify-center rounded-full">0</span>
                        </button>
                        <div class="pt-1 pb-0.5">
                            <p class="px-4 py-1 text-xs font-semibold text-gray-400 uppercase tracking-wider">More</p>
                        </div>
                        <button onclick="switchView('notes',this)"
                            class="sidebar-item w-full flex items-center gap-3 px-4 py-2.5 rounded-xl text-left text-sm font-medium text-gray-700">
                            <i data-lucide="edit-3" class="w-4 h-4 flex-shrink-0"></i> Notes
                        </button>
                        <button onclick="switchView('loans',this)"
                            class="sidebar-item w-full flex items-center gap-3 px-4 py-2.5 rounded-xl text-left text-sm font-medium text-gray-700">
                            <i data-lucide="banknote" class="w-4 h-4 flex-shrink-0"></i> Loans & Income
                        </button>
                    </div>
                </nav>

                <!-- User Info Footer -->
                <div class="p-3 border-t border-gray-100 block md:block">
                    <button onclick="switchView('settings')"
                        class="w-full flex items-center gap-3 px-3 py-2 rounded-xl bg-gray-50 hover:bg-gray-100 transition-colors text-left group">
                        <div id="sidebarAvatarWrap"
                            class="w-8 h-8 rounded-full bg-indigo-100 flex items-center justify-center flex-shrink-0 group-hover:bg-indigo-200 transition-colors overflow-hidden">
                            <i data-lucide="user" class="w-4 h-4 text-indigo-600" id="sidebarAvatarIcon"></i>
                        </div>
                        <div class="min-w-0 flex-1">
                            <p id="currentUser" class="text-sm font-semibold text-gray-900 truncate">Admin</p>
                            <p id="currentBranch" class="text-xs text-gray-400 truncate">Manage Account</p>
                        </div>
                    </button>
                </div>
            </aside>
            <!-- Background Logo Watermark -->
            <div
                class="fixed inset-0 pointer-events-none z-0 flex items-center justify-center opacity-[0.04] overflow-hidden">
                <img src="bg_logo.png" alt=""
                    class="w-[80vw] h-[80vh] max-w-[800px] max-h-[800px] object-contain object-center">
            </div>

            <!-- Main Content -->
            <main class="flex-1 overflow-auto bg-transparent p-6 relative z-10" id="mainContent">
                <!-- Injected by JS -->
            </main>
        </div>
    </div>

    <!-- â”€â”€ Modal Overlay â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ -->
    <div id="modalOverlay"
        class="hidden fixed inset-0 bg-black bg-opacity-40 backdrop-blur-sm z-50 flex items-center justify-center p-4">
        <div id="modalContent"
            class="bg-white rounded-2xl shadow-2xl max-w-lg w-full max-h-[90vh] overflow-auto modal-enter">
            <!-- Modal content injected by JS -->
        </div>
    </div>

    <!-- â”€â”€ Toast Container â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ -->
    <div id="toast-container"></div>

    <!-- â”€â”€ Notifications Slide-over â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ -->
    <div id="notifOverlay" class="hidden fixed inset-0 bg-black/50 z-20 backdrop-blur-sm transition-opacity"
        onclick="closeNotifications()"></div>
    <div id="notifPanel"
        class="fixed top-[57px] right-0 w-[280px] md:w-80 bg-white m-4 h-[calc(100dvh-57px-32px)] rounded-3xl shadow-[-4px_0_24px_rgba(0,0,0,0.04)] transform translate-x-[calc(100%+2rem)] transition-transform duration-300 ease-[cubic-bezier(0.4,0,0.2,1)] z-30 flex flex-col border border-gray-100/50">
        <div class="px-6 py-5 border-b border-gray-100 flex items-center justify-between">
            <div class="flex items-center gap-3">
                <div class="w-10 h-10 bg-indigo-50 rounded-xl flex items-center justify-center text-indigo-600">
                    <i data-lucide="bell" class="w-5 h-5"></i>
                </div>
                <div>
                    <h3 class="text-base font-bold text-gray-900">Notifications</h3>
                    <p class="text-[10px] text-gray-400 font-bold uppercase tracking-widest">Update Feed</p>
                </div>
            </div>
            <button onclick="closeNotifications()"
                class="text-gray-400 hover:text-gray-900 p-2 rounded-xl hover:bg-gray-100 transition-all">
                <i data-lucide="x" class="w-5 h-5"></i>
            </button>
        </div>
        <div id="notifContent" class="flex-1 overflow-y-auto p-4 space-y-1">
            <!-- Injected by JS -->
        </div>
    </div>

    <!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
    <!--  Vite Main Entry Point                                             -->
    <!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
    <script type="module" src="/js/main.js"></script>

    <!-- 6. Initialize Lucide icons on page load -->
    <script>
        function initAppScripts() {
            lucide.createIcons();
            // Register Service Worker
            if ('serviceWorker' in navigator) {
                navigator.serviceWorker.register('sw.js')
                    .then(reg => {
                        console.log('Service Worker Registered');
                    })
                    .catch(err => console.error('Service Worker Failed', err));

                // Reload when a new Service Worker takes control
                let refreshing = false;
                navigator.serviceWorker.addEventListener('controllerchange', () => {
                    if (refreshing) return;
                    refreshing = true;
                    console.log('New Service Worker activated, reloading page');
                    window.location.reload();
                });
            }
        }
        if (document.readyState === 'loading') {
            document.addEventListener('DOMContentLoaded', initAppScripts);
        } else {
            initAppScripts();
        }
    </script>

    <!-- Global Global Loading Overlay -->
    <div id="global-loader" class="hidden">
        <div class="loader-content">
            <div class="premium-spinner"></div>
            <p id="loader-message" class="loader-text">Just a moment...</p>
        </div>
    </div>
</body>

</html>