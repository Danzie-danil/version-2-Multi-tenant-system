<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>BMS – Business Management System</title>

    <!-- External Libraries -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/lucide@latest"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/3.9.1/chart.min.js"></script>

    <!-- App Styles -->
    <link rel="stylesheet" href="css/index.css">
</head>

<body class="bg-gray-50 text-gray-900">

    <!-- ── Login Screen ──────────────────────────────────────────────────── -->
    <div id="loginScreen" class="fixed inset-0 gradient-bg flex items-center justify-center z-50">
        <div class="bg-white rounded-2xl shadow-2xl p-8 w-full max-w-md modal-enter">
            <div class="text-center mb-8">
                <div
                    class="w-16 h-16 bg-indigo-600 rounded-2xl flex items-center justify-center mx-auto mb-4 shadow-lg">
                    <i data-lucide="building-2" class="w-8 h-8 text-white"></i>
                </div>
                <h1 class="text-2xl font-bold text-gray-900">BMS</h1>
                <p class="text-gray-500 mt-1 text-sm">Business Management System</p>
            </div>

            <div class="space-y-4">
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-1">Select Role</label>
                    <select id="roleSelect" class="form-input">
                        <option value="owner">Business Owner</option>
                        <option value="branch">Branch Manager</option>
                    </select>
                </div>

                <div id="branchSelector" class="hidden">
                    <label class="block text-sm font-medium text-gray-700 mb-1">Select Branch</label>
                    <select id="branchSelect" class="form-input">
                        <option value="downtown">Downtown Branch</option>
                        <option value="mall">Shopping Mall Branch</option>
                        <option value="airport">Airport Branch</option>
                    </select>
                </div>

                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-1">Security PIN</label>
                    <input type="password" id="pinInput" maxlength="6" placeholder="Enter 6-digit PIN"
                        class="form-input text-center tracking-widest text-lg"
                        onkeydown="if(event.key==='Enter') login()">
                </div>

                <button onclick="login()" class="w-full btn-primary justify-center py-3 text-base rounded-xl">
                    <i data-lucide="log-in" class="w-5 h-5"></i>
                    Access Dashboard
                </button>
            </div>

            <p class="mt-6 text-center text-xs text-gray-400">
                Demo: Owner PIN <code class="bg-gray-100 px-1 rounded">123456</code> &nbsp;|&nbsp;
                Branch PIN <code class="bg-gray-100 px-1 rounded">000000</code>
            </p>
        </div>
    </div>

    <!-- ── Main Application ───────────────────────────────────────────────── -->
    <div id="app" class="hidden">
        <!-- Header -->
        <header class="bg-white border-b border-gray-100 sticky top-0 z-40 shadow-sm">
            <div class="flex items-center justify-between px-6 py-3.5">
                <div class="flex items-center gap-3">
                    <div class="w-9 h-9 bg-indigo-600 rounded-xl flex items-center justify-center shadow-sm">
                        <i data-lucide="building-2" class="w-5 h-5 text-white"></i>
                    </div>
                    <div>
                        <h1 class="font-bold text-base leading-tight">BMS</h1>
                        <p id="userRole" class="text-xs text-gray-400 leading-tight">Business Owner</p>
                    </div>
                </div>

                <div class="flex items-center gap-3">
                    <div id="liveIndicator"
                        class="hidden items-center gap-2 px-3 py-1 rounded-full bg-emerald-100 text-emerald-700 text-xs font-medium flex">
                        <span class="w-2 h-2 rounded-full live-indicator inline-block"></span> Live
                    </div>

                    <button onclick="showNotifications()"
                        class="relative p-2 text-gray-500 hover:bg-gray-100 rounded-lg transition-colors">
                        <i data-lucide="bell" class="w-5 h-5"></i>
                        <span id="notifBadge"
                            class="absolute top-1.5 right-1.5 w-2 h-2 bg-red-500 rounded-full hidden"></span>
                    </button>

                    <button onclick="logout()" title="Logout"
                        class="p-2 text-gray-500 hover:bg-red-50 hover:text-red-600 rounded-lg transition-colors">
                        <i data-lucide="log-out" class="w-5 h-5"></i>
                    </button>
                </div>
            </div>
        </header>

        <div class="flex h-[calc(100vh-57px)]">
            <!-- Sidebar -->
            <aside class="w-60 bg-white border-r border-gray-100 flex flex-col flex-shrink-0">
                <nav class="flex-1 p-3 space-y-0.5 overflow-y-auto" id="sidebarNav">

                    <!-- Owner Navigation -->
                    <div id="ownerNav" class="hidden space-y-0.5">
                        <button onclick="switchView('overview',this)"
                            class="sidebar-item active w-full flex items-center gap-3 px-4 py-2.5 rounded-xl text-left text-sm font-medium text-indigo-600 bg-indigo-50">
                            <i data-lucide="layout-dashboard" class="w-4 h-4 flex-shrink-0"></i> Overview
                        </button>
                        <button onclick="switchView('branches',this)"
                            class="sidebar-item w-full flex items-center gap-3 px-4 py-2.5 rounded-xl text-left text-sm font-medium text-gray-700">
                            <i data-lucide="git-branch" class="w-4 h-4 flex-shrink-0"></i> Branches
                        </button>
                        <button onclick="switchView('tasks',this)"
                            class="sidebar-item w-full flex items-center gap-3 px-4 py-2.5 rounded-xl text-left text-sm font-medium text-gray-700">
                            <i data-lucide="check-square" class="w-4 h-4 flex-shrink-0"></i> Tasks & Objectives
                        </button>
                        <button onclick="switchView('analytics',this)"
                            class="sidebar-item w-full flex items-center gap-3 px-4 py-2.5 rounded-xl text-left text-sm font-medium text-gray-700">
                            <i data-lucide="bar-chart-3" class="w-4 h-4 flex-shrink-0"></i> Analytics
                        </button>
                        <button onclick="switchView('security',this)"
                            class="sidebar-item w-full flex items-center gap-3 px-4 py-2.5 rounded-xl text-left text-sm font-medium text-gray-700">
                            <i data-lucide="shield" class="w-4 h-4 flex-shrink-0"></i> Security
                        </button>
                    </div>

                    <!-- Branch Navigation -->
                    <div id="branchNav" class="hidden space-y-0.5">
                        <button onclick="switchView('dashboard',this)"
                            class="sidebar-item active w-full flex items-center gap-3 px-4 py-2.5 rounded-xl text-left text-sm font-medium text-indigo-600 bg-indigo-50">
                            <i data-lucide="home" class="w-4 h-4 flex-shrink-0"></i> Dashboard
                        </button>
                        <button onclick="switchView('sales',this)"
                            class="sidebar-item w-full flex items-center gap-3 px-4 py-2.5 rounded-xl text-left text-sm font-medium text-gray-700">
                            <i data-lucide="shopping-cart" class="w-4 h-4 flex-shrink-0"></i> Sales
                        </button>
                        <button onclick="switchView('expenses',this)"
                            class="sidebar-item w-full flex items-center gap-3 px-4 py-2.5 rounded-xl text-left text-sm font-medium text-gray-700">
                            <i data-lucide="credit-card" class="w-4 h-4 flex-shrink-0"></i> Expenses
                        </button>
                        <button onclick="switchView('inventory',this)"
                            class="sidebar-item w-full flex items-center gap-3 px-4 py-2.5 rounded-xl text-left text-sm font-medium text-gray-700">
                            <i data-lucide="package" class="w-4 h-4 flex-shrink-0"></i> Inventory
                        </button>
                        <button onclick="switchView('customers',this)"
                            class="sidebar-item w-full flex items-center gap-3 px-4 py-2.5 rounded-xl text-left text-sm font-medium text-gray-700">
                            <i data-lucide="users" class="w-4 h-4 flex-shrink-0"></i> Customers
                        </button>
                        <button onclick="switchView('tasks',this)"
                            class="sidebar-item w-full flex items-center gap-3 px-4 py-2.5 rounded-xl text-left text-sm font-medium text-gray-700">
                            <i data-lucide="list-todo" class="w-4 h-4 flex-shrink-0"></i> My Tasks
                        </button>
                        <button onclick="switchView('reports',this)"
                            class="sidebar-item w-full flex items-center gap-3 px-4 py-2.5 rounded-xl text-left text-sm font-medium text-gray-700">
                            <i data-lucide="file-text" class="w-4 h-4 flex-shrink-0"></i> Reports
                        </button>
                        <div class="pt-1 pb-0.5">
                            <p class="px-4 py-1 text-xs font-semibold text-gray-400 uppercase tracking-wider">More</p>
                        </div>
                        <button onclick="switchView('notes',this)"
                            class="sidebar-item w-full flex items-center gap-3 px-4 py-2.5 rounded-xl text-left text-sm font-medium text-gray-700">
                            <i data-lucide="edit-3" class="w-4 h-4 flex-shrink-0"></i> Notes
                        </button>
                        <button onclick="switchView('loans',this)"
                            class="sidebar-item w-full flex items-center gap-3 px-4 py-2.5 rounded-xl text-left text-sm font-medium text-gray-700">
                            <i data-lucide="banknote" class="w-4 h-4 flex-shrink-0"></i> Loans & Income
                        </button>
                    </div>
                </nav>

                <!-- User Info Footer -->
                <div class="p-3 border-t border-gray-100">
                    <div class="flex items-center gap-3 px-3 py-2 rounded-xl bg-gray-50">
                        <div class="w-8 h-8 rounded-full bg-indigo-100 flex items-center justify-center flex-shrink-0">
                            <i data-lucide="user" class="w-4 h-4 text-indigo-600"></i>
                        </div>
                        <div class="min-w-0 flex-1">
                            <p id="currentUser" class="text-sm font-semibold text-gray-900 truncate">Admin</p>
                            <p id="currentBranch" class="text-xs text-gray-400 truncate">All Branches</p>
                        </div>
                    </div>
                </div>
            </aside>

            <!-- Main Content -->
            <main class="flex-1 overflow-auto bg-gray-50 p-6" id="mainContent">
                <!-- Injected by JS -->
            </main>
        </div>
    </div>

    <!-- ── Modal Overlay ──────────────────────────────────────────────────── -->
    <div id="modalOverlay"
        class="hidden fixed inset-0 bg-black bg-opacity-40 backdrop-blur-sm z-50 flex items-center justify-center p-4">
        <div id="modalContent"
            class="bg-white rounded-2xl shadow-2xl max-w-lg w-full max-h-[90vh] overflow-auto modal-enter">
            <!-- Modal content injected by JS -->
        </div>
    </div>

    <!-- ── Toast Container ────────────────────────────────────────────────── -->
    <div id="toast-container"></div>

    <!-- ═══════════════════════════════════════════════════════════════════ -->
    <!--  JS MODULE LOAD ORDER (dependencies first)                         -->
    <!-- ═══════════════════════════════════════════════════════════════════ -->

    <!-- 1. Shared State -->
    <script src="js/state.js"></script>

    <!-- 2. Core Utilities -->
    <script src="js/utils.js"></script>
    <script src="js/auth.js"></script>
    <script src="js/simulation.js"></script>
    <script src="js/modals.js"></script>

    <!-- 3. Owner Modules -->
    <script src="js/owner/overview.js"></script>
    <script src="js/owner/branches.js"></script>
    <script src="js/owner/tasks.js"></script>
    <script src="js/owner/analytics.js"></script>
    <script src="js/owner/security.js"></script>

    <!-- 4. Branch Modules -->
    <script src="js/branch/dashboard.js"></script>
    <script src="js/branch/sales.js"></script>
    <script src="js/branch/expenses.js"></script>
    <script src="js/branch/inventory.js"></script>
    <script src="js/branch/customers.js"></script>
    <script src="js/branch/tasks.js"></script>
    <script src="js/branch/reports.js"></script>
    <script src="js/branch/notes.js"></script>
    <script src="js/branch/loans.js"></script>

    <!-- 5. Main App Router (last — depends on everything above) -->
    <script src="js/app.js"></script>

    <!-- 6. Initialize Lucide icons on page load -->
    <script>
        document.addEventListener('DOMContentLoaded', () => lucide.createIcons());
    </script>

</body>

</html>